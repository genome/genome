#!/usr/bin/env genome-perl
use strict;
use warnings;

use above "Genome";

use Data::Dumper 'Dumper';
use Test::More;

$ENV{UR_DBI_NO_COMMIT} = 1;
$ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;

use_ok('Genome::Individual') or die;

my $id = -54321;
my $individual = Genome::Individual->get($id);
ok(!$individual, 'individual does not exist');

my $taxon = Genome::Taxon->create(
    species_name => 'human',
    name => 'test taxon',
);
ok($taxon, 'human taxon');
$individual = Genome::Individual->create(
    id => $id,
    name => 'George Bush',
    taxon_id => $taxon->taxon_id,
    upn => 'GWB',
    common_name => 'The Prez',
    gender => 'male',
    ethnicity => 'texan',
    race => 'white',
    description => 'The best president in 2004',
);
ok($individual, 'created individual');
isa_ok($individual, 'Genome::Individual');
isa_ok($individual, 'Genome::Notable');
is($individual->id, $id, "id");
is($individual->__display_name__, "George Bush (The Prez $id)", "display name");
is($individual->subject_type, 'sample_group', 'subject type is sample_group');
print Data::Dumper::Dumper($individual);

my $commit = eval{ UR::Context->commit; };
ok($commit, 'commit');

$individual = Genome::Individual->get($id);
ok($individual, 're-get individual');

done_testing();
