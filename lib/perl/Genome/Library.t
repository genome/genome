#!/usr/bin/env genome-perl
use strict;
use warnings;

use above "Genome";

use Data::Dumper 'Dumper';
use Test::More;

$ENV{UR_DBI_NO_COMMIT} = 1;
$ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;

use_ok('Genome::Library') or die;

# create 2X
_create_and_get_library(1);

done_testing();


#################################

sub _create_and_get_library {
    my $sample = Genome::Sample->get(2376482668);
    my $library = Genome::Library->create(
        sample => $sample,
        name => $sample->name . "-extlibs",
        original_insert_size => '1kb',
        library_insert_size => '300-500',
        protocol => 'karate chop',
    );
    ok($library, 'created library');
    isa_ok($library, 'Genome::Library');
    isa_ok($library, 'Genome::Notable');
    ok($library->id, 'id');
    is($library->name, $sample->name . "-extlibs", "name is what is expected");
    print Data::Dumper::Dumper($library);

    my $commit = eval{ UR::Context->commit; };
    ok($commit, 'commit');

    $library = Genome::Library->get($library->id);
    ok($library, 're-get library');

    ok($library->taxon_id, 'taxon id: '.$library->taxon_id);
    ok($library->species_name, 'species name: '.$library->species_name);

    return 1;
}
