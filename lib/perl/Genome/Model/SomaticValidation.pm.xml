<?xml version='1.0' standalone='yes'?>

<workflow name="Somatic Variant Validation Pipeline" logDir="/gsc/var/log/genome/somatic_variant_validation">
  <link fromOperation="input connector" fromProperty="build_id" toOperation="Alignments" toProperty="build_id" />
  <link fromOperation="input connector" fromProperty="build_id" toOperation="Detect Variants" toProperty="build_id" />
  <link fromOperation="input connector" fromProperty="tumor_mode" toOperation="Reference Coverage Stats (Tumor)" toProperty="mode" />
  <link fromOperation="input connector" fromProperty="normal_mode" toOperation="Reference Coverage Stats (Normal)" toProperty="mode" />

  <link fromOperation="Alignments" fromProperty="build_id" toOperation="Reference Coverage Stats (Tumor)" toProperty="build_id" />
  <link fromOperation="Alignments" fromProperty="build_id" toOperation="Reference Coverage Stats (Normal)" toProperty="build_id" />

  <link fromOperation="Reference Coverage Stats (Tumor)" fromProperty="result" toOperation="output connector" toProperty="tumor_reference_coverage_result"/>
  <link fromOperation="Reference Coverage Stats (Normal)" fromProperty="result" toOperation="output connector" toProperty="normal_reference_coverage_result"/>

  <link fromOperation="Alignments" fromProperty="merged_bam_path" toOperation="Detect Variants" toProperty="bam_path"/>
  <link fromOperation="Alignments" fromProperty="control_merged_bam_path" toOperation="Detect Variants" toProperty="control_bam_path"/>

  <link fromOperation="Detect Variants" fromProperty="hq_snv_file" toOperation="Varscan Process-Validation" toProperty="filtered_validation_file"/>
  <link fromOperation="Detect Variants" fromProperty="build_id" toOperation="Varscan Process-Validation" toProperty="build_id" />

  <link fromOperation="Detect Variants" fromProperty="build_id" toOperation="Identify DNPs" toProperty="build_id" />

  <link fromOperation="Detect Variants" fromProperty="build_id" toOperation="Identify LOH" toProperty="build_id" />
  <link fromOperation="Identify LOH" fromProperty="build_id" toOperation="Identify Previously Discovered Variations" toProperty="build_id" />
  <link fromOperation="Identify Previously Discovered Variations" fromProperty="build_id" toOperation="Tier Variants" toProperty="build_id" />
  <link fromOperation="Tier Variants" fromProperty="build_id" toOperation="output connector" toProperty="build_id" />

  <link fromOperation="input connector" fromProperty="targeted_snv_validation" toOperation="Varscan Process-Validation" toProperty="output_file" />
  <link fromOperation="input connector" fromProperty="minimum_coverage" toOperation="Varscan Process-Validation" toProperty="min_coverage" />
  <link fromOperation="input connector" fromProperty="output_plot" toOperation="Varscan Process-Validation" toProperty="output_plot" />

  <link fromOperation="Varscan Process-Validation" fromProperty="output_file" toOperation="output connector" toProperty="targeted_snv_validation_output" />
  <link fromOperation="Identify DNPs" fromProperty="dnp_result_id" toOperation="output connector" toProperty="dnp_result_id" />

  <operation name="Alignments">
      <operationtype commandClass="Genome::Model::SomaticValidation::Command::AlignReads" typeClass="Workflow::OperationType::Command"/>
  </operation>

  <operation name="Reference Coverage Stats (Tumor)">
      <operationtype commandClass="Genome::Model::SomaticValidation::Command::CoverageStats" typeClass="Workflow::OperationType::Command"/>
  </operation>
  <operation name="Reference Coverage Stats (Normal)">
      <operationtype commandClass="Genome::Model::SomaticValidation::Command::CoverageStats" typeClass="Workflow::OperationType::Command"/>
  </operation>

  <operation name="Detect Variants">
    <operationtype commandClass="Genome::Model::SomaticValidation::Command::DetectVariants" typeClass="Workflow::OperationType::Command" />
  </operation>

  <operation name="Identify DNPs">
    <operationtype commandClass="Genome::Model::SomaticValidation::Command::IdentifyDnp" typeClass="Workflow::OperationType::Command" />
  </operation>

  <operation name="Varscan Process-Validation">
    <operationtype commandClass="Genome::Model::SomaticValidation::Command::ProcessValidation" typeClass="Workflow::OperationType::Command" />
  </operation>

  <operation name="Identify LOH">
    <operationtype commandClass="Genome::Model::SomaticValidation::Command::Loh" typeClass="Workflow::OperationType::Command" />
  </operation>

  <operation name="Identify Previously Discovered Variations">
    <operationtype commandClass="Genome::Model::SomaticValidation::Command::IdentifyPreviouslyDiscoveredVariations" typeClass="Workflow::OperationType::Command" />
  </operation>

  <operation name="Tier Variants">
    <operationtype commandClass="Genome::Model::SomaticValidation::Command::TierVariants" typeClass="Workflow::OperationType::Command" />
  </operation>

  <operationtype typeClass="Workflow::OperationType::Model">
    <inputproperty>build_id</inputproperty>
    <inputproperty>output_plot</inputproperty>
    <inputproperty>targeted_snv_validation</inputproperty>
    <inputproperty>minimum_coverage</inputproperty>
    <inputproperty>tumor_mode</inputproperty>
    <inputproperty>normal_mode</inputproperty>

    <outputproperty>targeted_snv_validation_output</outputproperty>
    <outputproperty>dnp_result_id</outputproperty>
    <outputproperty>tumor_reference_coverage_result</outputproperty>
    <outputproperty>normal_reference_coverage_result</outputproperty>
    <outputproperty>build_id</outputproperty>
  </operationtype>

</workflow>
