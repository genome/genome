#!/usr/bin/env genome-perl

use strict;
use warnings;

use above 'Genome';
use Test::More;
use Genome::Utility::Test;
use Genome::Utility::Test qw(compare_ok);

BEGIN {
  $ENV{UR_DBI_NO_COMMIT} = 1;
  $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
}

use_ok('Genome::Model::Tools::Capture::FormatSnvs');

my $expected_output_dir =
  Genome::Utility::Test->data_dir_ok('Genome::Model::Tools::Capture::FormatSnvs','2015-02-12');

my $variants_file = File::Spec->join(
  $expected_output_dir,
  "varscan.snps",
);
ok(-e $variants_file, "Found variant file: $variants_file") or die;

my $temp_dir = Genome::Sys->create_temp_directory();
ok($temp_dir, "created temp directory: $temp_dir") or die;

my $formatter = Genome::Model::Tools::Capture::FormatSnvs->create(
  variants_file => $variants_file,
  outdir => $temp_dir,
);
$formatter->execute();

my $expected_outfile = File::Spec->join(
  $expected_output_dir,
  "varscan.snps.formatted"
);
ok(-e $expected_outfile, "Found expected outfile: $expected_outfile") or die;

my $outfile = File::Spec->join(
  $temp_dir,
  "varscan.snps.formatted",
);
ok(-e $outfile, "Found outfile: $outfile") or die;

#Perform a diff between the stored result and those generated by this test
compare_ok($expected_outfile, $outfile);

done_testing();
