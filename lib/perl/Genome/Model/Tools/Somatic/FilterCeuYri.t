#!/usr/bin/env genome-perl

use strict;
use warnings;

use above "Genome";
use Test::More tests => 5;
use File::Compare;

$ENV{UR_DBI_NO_COMMIT} = 1;
$ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;

use_ok( 'Genome::Model::Tools::Somatic::FilterCeuYri' );

my $test_input_dir  = $ENV{GENOME_TEST_INPUTS} . '/Genome-Model-Tools-Somatic-FilterCeuYri/';
my $variant_file    = $test_input_dir . 'variants.in';
my $datasource_file = $test_input_dir . 'datasource.in';

#The filtered.position.expected list assumes that filtering is based only on position.  If genotype must match, use filtered.genotype.expected
my $expected_output_file    = $test_input_dir . 'filtered.position.expected';

my $test_output_dir = File::Temp::tempdir('Genome-Model-Tools-Somatic-FilterCeuYri-XXXXX', DIR => "$ENV{GENOME_TEST_TEMP}", CLEANUP => 1);
$test_output_dir .= '/';
my $output_file     = $test_output_dir . 'filtered.out';

my $filter_ceu_yri  = Genome::Model::Tools::Somatic::FilterCeuYri->create(
    variant_file    => $variant_file,
    datasource_file  => $datasource_file,
    output_file     => $output_file
);

ok($filter_ceu_yri, 'created FilterCeuYri object');
ok($filter_ceu_yri->execute(), 'executed FilterCeuYri object');

ok(-s $output_file, 'generated filtered variant list');
is(compare($output_file, $expected_output_file), 0, 'filtered variant list matched expected result');
