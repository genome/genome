#!/usr/bin/env genome-perl

use strict;
use warnings;

use above "Genome";
use Test::More;
use File::Compare;

$ENV{UR_DBI_NO_COMMIT} = 1;
$ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;

BEGIN {
    my $archos = `uname -a`;
    if ($archos !~ /64/) {
        plan skip_all => "Must run from 64-bit machine";
    } else {
        plan tests => 5;
    }
};

use_ok( 'Genome::Model::Tools::Somatic::SnpFilter');

my $test_input_dir  = $ENV{GENOME_TEST_INPUTS} . '/Genome-Model-Tools-Somatic-SnpFilter/';
my $tumor_snp_file  = $test_input_dir . 'tumor.in';
my $sniper_snp_file = $test_input_dir . 'sniper.in';

my $expected_output_file = $test_input_dir . 'merged.expected';

my $test_output_dir = File::Temp::tempdir('Genome-Model-Tools-Somatic-FilterCeuYri-XXXXX', CLEANUP => 1, TMPDIR => 1);
$test_output_dir .= '/';
my $output_file     = $test_output_dir . 'merged.out';

my $snp_filter = Genome::Model::Tools::Somatic::SnpFilter->create(
    tumor_snp_file  => $tumor_snp_file,
    sniper_snp_file => $sniper_snp_file,
    output_file     => $output_file
);

ok($snp_filter, 'created SnpFilter object');
ok($snp_filter->execute(), 'executed SnpFilter object');

ok(-s $output_file, 'generated output file');
is(compare($output_file, $expected_output_file), 0, 'output matched expected results');
