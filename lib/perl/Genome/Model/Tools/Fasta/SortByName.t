BEGIN { 
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
}

use strict;
use warnings;

use above "Genome";
use Test::More;

use_ok('Genome::Model::Tools::Fasta::SortByName') or die;

my $test_data_dir = $ENV{GENOME_TEST_INPUTS} . '/Genome-Model-Tools-Fasta/';
ok(-d $test_data_dir, "test data dir existst at $test_data_dir");

my $test_output_dir = "$ENV{GENOME_TEST_TEMP}/";
ok(-d $test_output_dir, "test output dir exists at $test_output_dir");

my $unsorted = $test_data_dir . 'file_two_seq.fasta';
ok(-e $unsorted, "unsorted input fasta exists at $unsorted");

my $expected = $test_data_dir . 'file_two_seq.fasta.sorted';
ok(-e $expected, "expected output file exists at $expected");

my $output_fh = File::Temp->new(
    DIR => $test_output_dir,
    TEMPLATE => 'genome-model-tools-fasta-sortbyname-XXXXXX',
);
my $output = $output_fh->filename;
ok($output, "output will go into $output");

my $cmd = Genome::Model::Tools::Fasta::SortByName->create(
    input_fasta => $unsorted,
    sorted_fasta => $output,
);
ok($cmd, 'made fasta sorter command object');

ok($cmd->execute, 'executed sorter');

ok(!Genome::Sys->diff_file_vs_file($expected, $output), 'sorted file matches expected output');

done_testing();

