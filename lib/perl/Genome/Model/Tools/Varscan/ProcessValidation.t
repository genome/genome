#!/usr/bin/env genome-perl

use strict;
use warnings;

BEGIN {
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
};

use above 'Genome';

use Test::More tests => 5;

use_ok('Genome::Model::Tools::Varscan::ProcessValidation');

my $version = "v2";

my $test_data_dir = Genome::Config::get('test_inputs') . '/Genome-Model-Tools-Varscan-ProcessValidation' . "/$version";
print $test_data_dir . "\n";
my $variants_file = join('/', $test_data_dir, 'variant_list.snp');
my $validation_file = join('/', $test_data_dir, 'varscan.snp');
my $filtered_validation_file = join('/', $test_data_dir, 'varscan.snp.Somatic.strandfilter');

my $expected_output_file = join('/', $test_data_dir, 'targeted_snvs.validation');

my $tmpdir = File::Temp::tempdir('Varscan-ProcessValidationXXXXX', CLEANUP => 1, TMPDIR => 1);
my $output_file = join('/', $tmpdir, 'targeted_snvs.validation');
my $output_plot = join('/', $tmpdir, 'targeted_snvs.validation.plot');

my $validation_command = Genome::Model::Tools::Varscan::ProcessValidation->create(
    variants_file => $variants_file,
    validation_file => $validation_file,
    filtered_validation_file => $filtered_validation_file,
    output_file => $output_file,
    output_plot => 1,
);

isa_ok($validation_command, 'Genome::Model::Tools::Varscan::ProcessValidation', 'created validation command');
ok($validation_command->execute(), 'executed validation command');

ok(-s $validation_command->output_plot_file, 'created a plot');
ok(-s $validation_command->output_somatic_plot_file, 'created a somatic plot');
