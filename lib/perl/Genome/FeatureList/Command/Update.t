#!/usr/bin/env genome-perl

use strict;
use warnings;

BEGIN {
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1; #FeatureLists generate their own IDs, but this is still a good idea
};

use Test::More tests => 11;

use above 'Genome';
use Genome::Utility::Test qw(command_execute_ok);

my $cmd_class = 'Genome::FeatureList::Command::Update';
use_ok($cmd_class);

my $test_bed_file = __FILE__ . '.bed';
ok(-e $test_bed_file, 'test file ' . $test_bed_file . ' exists');

my $test_bed_file_md5 = Genome::Sys->md5sum($test_bed_file);

my $feature_list;
{
    local $ENV{UR_COMMAND_DUMP_STATUS_MESSAGES} = 0;
    $feature_list = Genome::FeatureList->create(
        name                => 'GFL test feature-list',
        format              => 'true-BED',
        content_type        => 'targeted',
        description         => 'dummy feature-list for testing the update command',
        file_path           => $test_bed_file,
        file_content_hash   => $test_bed_file_md5,
    );  
}

ok($feature_list, 'created a feature list');
isa_ok($feature_list, 'Genome::FeatureList');

my $update_cmd = $cmd_class->create(
    feature_list => [$feature_list],
    format => 'unknown', 
);
command_execute_ok($update_cmd,
    { status_messages => [ q(setting format to unknown) ] },
    'Update format to "unknown"');

is($feature_list->format, 'unknown', 'Successfully updated format');

$update_cmd = $cmd_class->create(
    feature_list => [$feature_list],
    format => 'true-BED', 
    source => 'test-data-makers',
    content_type => 'exome',
    description => 'updated description for the update command test',
);
command_execute_ok($update_cmd,
    { status_messages => [  q(setting content_type to exome),
                            q(setting description to updated description for the update command test),
                            q(setting format to true-BED),
                            q(setting source to test-data-makers) ] },
    'Update many featurelist settings');

is($feature_list->format, 'true-BED', "Successfully updated format");
is($feature_list->source, 'test-data-makers', "Successfully updated source");
is($feature_list->content_type, 'exome', "Successfully updated content_type");
is($feature_list->description, 'updated description for the update command test', );
