#!/usr/bin/env genome-perl

BEGIN {
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
    $ENV{UR_COMMAND_DUMP_STATUS_MESSAGES} = 1;
}

use strict;
use warnings;

use above "Genome";

use Test::More;

use_ok('Genome::Sample::Command::Import') or die;
ok(Genome::Sample::Command::Import::EmblEbi->__meta__, 'class meta for import embl-ebi sample');

my $taxon = Genome::Taxon->__define__(name => 'almost human');
ok($taxon, 'defined taxon');
my $individual_name = 'EMBL-HCT00000';
my $name = $individual_name.'-ERS000000';
my $import = Genome::Sample::Command::Import::EmblEbi->create(
    taxon => $taxon,
    name => $name,
    ethnicity => 'caucasian',
    gender => 'male',
    tissue_label => 'heart',
    extraction_type => 'rna',
    age => 25,
);
ok($import, 'create');
ok($import->execute, 'execute');

is($import->_individual->name, $individual_name, 'patient name');
is($import->_individual->nomenclature, 'EMBL-EBI', 'patient nomenclature');
is($import->_individual->gender, 'male', 'patient gender');
is($import->_individual->ethnicity, 'caucasian', 'patient ethnicity');
is($import->_sample->name, $name, 'sample name');
is($import->_sample->nomenclature, 'EMBL-EBI', 'sample nomenclature');
is($import->_sample->extraction_label, $name, 'sample extraction label');
is($import->_sample->extraction_type, 'rna', 'sample extraction type');
is($import->_sample->tissue_label, 'heart', 'sample tissue');
is($import->_sample->tissue_desc, 'heart', 'sample tissue');
is($import->_sample->age, 25, 'sample age');
is_deeply($import->_sample->source, $import->_individual, 'sample source');
my $library_name = $name.'-extlibs';
is($import->_library->name, $library_name, 'library name');
is_deeply($import->_library->sample, $import->_sample, 'library sample');

done_testing();
